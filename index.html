<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 여행 앨범 메이커</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            scroll-behavior: smooth;
        }
        .drag-area-highlight {
            background-color: #e0f2fe; /* light blue */
            border-color: #0284c7; /* sky blue */
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .loader {
            border-top-color: #38bdf8;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        #modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen sm:p-4">

    <div class="container mx-auto w-full h-screen sm:h-auto sm:min-h-[90vh] max-w-6xl bg-white sm:rounded-2xl sm:shadow-2xl flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="p-4 sm:p-6 border-b border-slate-200 flex justify-between items-center bg-slate-50 flex-shrink-0">
            <div class="flex items-center space-x-3">
                 <button id="menu-toggle-button" class="hidden md:hidden p-2 rounded-md hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <svg class="w-6 h-6 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                 </button>
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <svg class="w-7 h-7 sm:w-8 sm:h-8 text-sky-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/><path d="m15 12-3 3 3 3"/></svg>
                    <h1 class="text-xl sm:text-2xl font-bold text-slate-700">AI 여행 앨범 메이커</h1>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button id="export-button" class="hidden bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-3 sm:px-5 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    <span class="hidden sm:inline">앨범으로 내보내기</span>
                </button>
                <button id="slideshow-button" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 sm:px-5 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    <span class="hidden sm:inline">슬라이드쇼 만들기</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-grow flex relative overflow-hidden">
            <!-- Sidebar for navigation -->
            <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden"></div>
            <aside id="sidebar" class="hidden fixed inset-y-0 left-0 z-40 w-72 bg-slate-50 border-r border-slate-200 overflow-y-auto custom-scrollbar transform -translate-x-full transition-transform duration-300 ease-in-out md:relative md:w-64 md:translate-x-0 md:flex-shrink-0 flex flex-col p-6">
                <div class="flex-grow">
                    <h3 class="text-lg font-bold mb-4 text-slate-600">카테고리 필터</h3>
                    <nav id="category-nav" class="space-y-2">
                        <!-- Dynamic category links -->
                    </nav>
                    <div class="mt-8 pt-6 border-t border-slate-200">
                         <h3 class="text-lg font-bold mb-4 text-slate-600">여행 일정</h3>
                         <nav id="date-nav" class="space-y-2">
                            <!-- Dynamic date links -->
                         </nav>
                         <button id="filter-reset-button" class="hidden w-full text-center mt-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-3 rounded-lg transition-all">필터 초기화</button>
                    </div>
                </div>
                 <div class="flex-shrink-0 pt-6 mt-6 border-t border-slate-200">
                    <div id="sidebar-actions" class="space-y-3">
                         <input type="file" id="add-files-input" multiple accept="image/*" class="hidden">
                         <label for="add-files-input" class="cursor-pointer w-full text-center block bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-3 rounded-lg transition-all">
                             사진 추가하기
                         </label>
                         <button id="reset-album-button" class="w-full text-center block bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-3 rounded-lg transition-all">
                             새로 시작하기
                         </button>
                    </div>
                </div>
            </aside>

            <main class="flex-grow flex flex-col items-center justify-center p-4 sm:p-8 transition-all duration-500 w-full overflow-y-auto custom-scrollbar" id="main-content">
                <!-- Upload Section -->
                <div id="upload-section" class="w-full max-w-2xl text-center">
                    <div id="drag-area" class="border-4 border-dashed border-slate-300 rounded-2xl p-6 sm:p-12 transition-all duration-300 hover:border-sky-400 hover:bg-sky-50">
                        <div class="flex flex-col items-center space-y-4">
                            <svg class="w-16 h-16 sm:w-20 sm:h-20 text-slate-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                            <p class="text-lg sm:text-xl text-slate-600">여기에 사진을 드래그 앤 드롭하세요</p>
                            <p class="text-slate-500">또는</p>
                            <input type="file" id="file-input" multiple accept="image/*" class="hidden">
                            <label for="file-input" class="cursor-pointer bg-white border border-slate-300 text-slate-700 font-semibold py-2 px-6 rounded-lg hover:bg-slate-100 transition-all">
                                파일 선택하기
                            </label>
                            <p class="text-sm text-slate-400 pt-4">최대 60장의 이미지를 업로드할 수 있습니다.</p>
                        </div>
                    </div>
                </div>

                <!-- Progress Section -->
                <div id="progress-section" class="hidden w-full max-w-lg text-center">
                    <div class="flex items-center justify-center space-x-3 mb-4">
                         <div class="loader ease-linear rounded-full border-4 border-t-4 border-slate-200 h-12 w-12"></div>
                         <h2 class="text-xl sm:text-2xl font-semibold text-slate-700">Gemini가 사진을 분석하고 있습니다...</h2>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-4 my-4 overflow-hidden">
                        <div id="progress-bar" class="bg-sky-400 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="text-slate-500">사진의 날짜와 내용을 분석하는 중입니다.</p>
                    <p id="progress-details" class="text-sm text-slate-400 mt-2"></p>
                </div>

                <!-- Results Section (Gallery) -->
                <div id="results-section" class="hidden w-full h-full">
                     <div id="gallery" class="w-full">
                         <!-- Dynamic content will be inserted here -->
                     </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for notifications -->
    <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full text-center transform transition-all" id="modal-content">
            <p id="notification-message" class="text-lg text-slate-700 mb-6"></p>
            <div id="modal-buttons" class="flex justify-center gap-4">
                <button id="notification-confirm" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">확인</button>
                <button id="notification-cancel" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-6 rounded-lg transition-colors">취소</button>
            </div>
        </div>
    </div>

    <!-- Slideshow Creation Modal -->
    <div id="slideshow-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-2xl w-full transform transition-all" id="slideshow-modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">동영상 슬라이드쇼 만들기</h2>
                <button id="slideshow-close" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Settings Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">사진당 표시 시간</label>
                        <select id="photo-duration" class="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            <option value="2">2초</option>
                            <option value="3" selected>3초</option>
                            <option value="4">4초</option>
                            <option value="5">5초</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">전환 효과</label>
                        <select id="transition-effect" class="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                            <option value="fade" selected>페이드</option>
                            <option value="slide">슬라이드</option>
                            <option value="zoom">줌</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">배경 음악</label>
                    <input type="file" id="background-music" accept="audio/*" class="w-full border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                    <p class="text-xs text-slate-500 mt-1">MP3, WAV, OGG 형식 지원 (선택사항)</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">사진 순서</label>
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="photo-order" value="date" checked class="mr-2">
                            <span>날짜순</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="photo-order" value="random" class="mr-2">
                            <span>랜덤</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="photo-order" value="category" class="mr-2">
                            <span>카테고리별</span>
                        </label>
                    </div>
                </div>
                
                <!-- Preview Section -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">미리보기</label>
                    <div id="slideshow-preview" class="border-2 border-dashed border-slate-300 rounded-lg p-4 text-center text-slate-500">
                        <p>설정을 변경하면 여기에 미리보기가 표시됩니다</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 mt-8">
                <button id="slideshow-cancel" class="px-6 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors">취소</button>
                <button id="slideshow-create" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>슬라이드쇼 생성</span>
                </button>
            </div>
        </div>
    </div>


    <script>
        // DOM Elements
        const dragArea = document.getElementById('drag-area');
        const fileInput = document.getElementById('file-input');
        const addFilesInput = document.getElementById('add-files-input');
        const uploadSection = document.getElementById('upload-section');
        const progressSection = document.getElementById('progress-section');
        const resultsSection = document.getElementById('results-section');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const progressDetails = document.getElementById('progress-details');
        const exportButton = document.getElementById('export-button');
        const gallery = document.getElementById('gallery');
        const categoryNav = document.getElementById('category-nav');
        const dateNav = document.getElementById('date-nav');
        const notificationModal = document.getElementById('notification-modal');
        const notificationMessage = document.getElementById('notification-message');
        const modalContent = document.getElementById('modal-content');
        const notificationConfirm = document.getElementById('notification-confirm');
        const notificationCancel = document.getElementById('notification-cancel');
        const menuToggleButton = document.getElementById('menu-toggle-button');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const resetAlbumButton = document.getElementById('reset-album-button');
        const filterResetButton = document.getElementById('filter-reset-button');
        
        // Slideshow elements
        const slideshowButton = document.getElementById('slideshow-button');
        const slideshowModal = document.getElementById('slideshow-modal');
        const slideshowClose = document.getElementById('slideshow-close');
        const slideshowCancel = document.getElementById('slideshow-cancel');
        const slideshowCreate = document.getElementById('slideshow-create');
        const slideshowModalContent = document.getElementById('slideshow-modal-content');
        const photoDuration = document.getElementById('photo-duration');
        const transitionEffect = document.getElementById('transition-effect');
        const backgroundMusic = document.getElementById('background-music');
        const slideshowPreview = document.getElementById('slideshow-preview');

        const MAX_FILES = 60;
        let uploadedPhotos = [];
        let activeCategoryFilter = null;
        let activeDateFilter = null;

        // --- IndexedDB Helper ---
        const db = {
            _db: null,
            init: function() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('TravelAlbumDB', 1);
                    request.onupgradeneeded = event => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('photos')) {
                            db.createObjectStore('photos', { keyPath: 'id' });
                        }
                    };
                    request.onsuccess = event => {
                        this._db = event.target.result;
                        resolve();
                    };
                    request.onerror = event => {
                        console.error('IndexedDB error:', event.target.errorCode);
                        reject(event.target.errorCode);
                    };
                });
            },
            savePhotos: function(photos) {
                return new Promise((resolve, reject) => {
                    if (!this._db) return reject('DB not initialized');
                    const transaction = this._db.transaction(['photos'], 'readwrite');
                    const store = transaction.objectStore('photos');
                    const clearRequest = store.clear();
                    clearRequest.onsuccess = () => {
                        if (photos.length === 0) { resolve(); return; }
                        let count = 0;
                        photos.forEach(photo => {
                            const addRequest = store.add(photo);
                            addRequest.onsuccess = () => {
                                count++;
                                if (count === photos.length) resolve();
                            };
                            addRequest.onerror = (event) => reject(event.target.error);
                        });
                    };
                    clearRequest.onerror = (event) => reject(event.target.error);
                });
            },
            getPhotos: function() {
                return new Promise((resolve, reject) => {
                    if (!this._db) return reject('DB not initialized');
                    const transaction = this._db.transaction(['photos'], 'readonly');
                    const store = transaction.objectStore('photos');
                    const request = store.getAll();
                    request.onsuccess = event => resolve(event.target.result);
                    request.onerror = event => reject(event.target.error);
                });
            },
            clearPhotos: function() {
                return new Promise((resolve, reject) => {
                    if (!this._db) return reject('DB not initialized');
                    const transaction = this._db.transaction(['photos'], 'readwrite');
                    const store = transaction.objectStore('photos');
                    const request = store.clear();
                    request.onsuccess = () => resolve();
                    request.onerror = (event) => reject(event.target.error);
                });
            }
        };


        // --- Slideshow Modal Event Listeners ---
        slideshowButton.addEventListener('click', () => {
            slideshowModal.classList.remove('hidden');
            slideshowModalContent.classList.remove('opacity-0', 'scale-95');
            updateSlideshowPreview();
        });
        
        slideshowClose.addEventListener('click', hideSlideshowModal);
        slideshowCancel.addEventListener('click', hideSlideshowModal);
        
        slideshowModal.addEventListener('click', (e) => {
            if (e.target === slideshowModal) hideSlideshowModal();
        });
        
        // Update preview when settings change
        [photoDuration, transitionEffect].forEach(element => {
            element.addEventListener('change', updateSlideshowPreview);
        });
        
        backgroundMusic.addEventListener('change', updateSlideshowPreview);
        
        document.querySelectorAll('input[name="photo-order"]').forEach(radio => {
            radio.addEventListener('change', updateSlideshowPreview);
        });
        
        slideshowCreate.addEventListener('click', createSlideshow);
        
        function hideSlideshowModal() {
            slideshowModalContent.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                slideshowModal.classList.add('hidden');
            }, 300);
        }
        
        function updateSlideshowPreview() {
            const duration = photoDuration.value;
            const effect = transitionEffect.value;
            const order = document.querySelector('input[name="photo-order"]:checked').value;
            const musicFile = backgroundMusic.files[0];
            
            let previewText = `설정: ${duration}초/사진, ${effect} 효과, ${getOrderText(order)}`;
            if (musicFile) {
                previewText += `, 음악: ${musicFile.name}`;
            }
            
            const totalDuration = Math.round((uploadedPhotos.length * duration) / 60 * 10) / 10;
            previewText += `\n예상 총 재생 시간: ${totalDuration}분`;
            
            slideshowPreview.innerHTML = `<p class="text-sm">${previewText}</p>`;
        }
        
        function getOrderText(order) {
            switch(order) {
                case 'date': return '날짜순';
                case 'random': return '랜덤';
                case 'category': return '카테고리별';
                default: return '날짜순';
            }
        }
        
        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', async () => {
             try {
                await db.init();
                const savedPhotos = await db.getPhotos();
                if (Array.isArray(savedPhotos) && savedPhotos.length > 0) {
                    uploadedPhotos = savedPhotos;
                    uploadSection.classList.add('hidden');
                    displayResults();
                }
            } catch(e) {
                console.error("Failed to load photos from DB:", e);
                showNotification("저장된 앨범을 불러오는 데 실패했습니다.");
            }
        });

        // --- Mobile Sidebar Logic ---
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        }
        menuToggleButton.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // --- Modal/Notification Functions ---
        function showNotification(message) {
            notificationMessage.textContent = message;
            notificationConfirm.textContent = '확인';
            notificationConfirm.onclick = hideNotification;
            notificationCancel.classList.add('hidden');
            notificationModal.classList.remove('hidden');
            modalContent.classList.remove('opacity-0', 'scale-95');
        }
        
        function showConfirmation(message, onConfirm) {
            notificationMessage.textContent = message;
            notificationConfirm.textContent = '확인';
            notificationCancel.classList.remove('hidden');
            notificationConfirm.onclick = () => {
                hideNotification();
                onConfirm();
            };
            notificationCancel.onclick = hideNotification;
            notificationModal.classList.remove('hidden');
            modalContent.classList.remove('opacity-0', 'scale-95');
        }

        function hideNotification() {
             modalContent.classList.add('opacity-0', 'scale-95');
             setTimeout(() => {
                notificationModal.classList.add('hidden');
             }, 300);
        }
        
        notificationModal.addEventListener('click', (e) => {
            if (e.target === notificationModal) hideNotification();
        });
        
        // --- File Handling & Drag n Drop ---
        ['dragover', 'dragleave', 'drop'].forEach(eventName => {
            dragArea.addEventListener(eventName, e => e.preventDefault());
        });
        dragArea.addEventListener('dragover', () => dragArea.classList.add('drag-area-highlight'));
        dragArea.addEventListener('dragleave', () => dragArea.classList.remove('drag-area-highlight'));
        dragArea.addEventListener('drop', (e) => {
            dragArea.classList.remove('drag-area-highlight');
            handleFiles(Array.from(e.dataTransfer.files), false);
        });
        fileInput.addEventListener('change', (e) => handleFiles(Array.from(e.target.files), false));
        addFilesInput.addEventListener('change', (e) => handleFiles(Array.from(e.target.files), true));

        async function handleFiles(files, isAdding) {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            if (imageFiles.length === 0) {
                showNotification('이미지 파일만 업로드할 수 있습니다.');
                return;
            }

            const currentCount = isAdding ? uploadedPhotos.length : 0;
            if (currentCount + imageFiles.length > MAX_FILES) {
                showNotification(`총 사진 개수가 ${MAX_FILES}장을 초과할 수 없습니다. (현재: ${currentCount}장)`);
                return;
            }

            if (!isAdding) {
                uploadedPhotos = [];
                activeCategoryFilter = null;
                activeDateFilter = null;
            }

            // Pre-read files to check for duplicates
            const readFileAsDataURL = (file) => {
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = e => resolve({ file, src: e.target.result });
                    reader.readAsDataURL(file);
                });
            };

            const fileReadPromises = imageFiles.map(readFileAsDataURL);
            const readFiles = await Promise.all(fileReadPromises);

            const existingSrcs = new Set(uploadedPhotos.map(p => p.src));
            const newUniqueFiles = [];
            let duplicateFileCount = 0;

            readFiles.forEach(({ file, src }) => {
                if (existingSrcs.has(src)) {
                    duplicateFileCount++;
                } else {
                    newUniqueFiles.push(file);
                    existingSrcs.add(src); // Also check against newly added files
                }
            });

            if (duplicateFileCount > 0) {
                if (newUniqueFiles.length > 0) {
                    const message = `${duplicateFileCount}개의 중복된 사진을 제외하고, ${newUniqueFiles.length}개의 새로운 사진을 추가하시겠습니까?`;
                    showConfirmation(message, () => {
                        startAnalysis(newUniqueFiles);
                    });
                } else {
                    showNotification(`${duplicateFileCount}개의 사진이 모두 중복되어 추가할 사진이 없습니다.`);
                }
            } else {
                if (newUniqueFiles.length > 0) {
                    startAnalysis(newUniqueFiles);
                }
            }
        }


        // --- Main Analysis Logic ---
        async function startAnalysis(files) {
            if (files.length === 0) return;

            uploadSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            progressSection.classList.remove('hidden');
            sidebar.classList.add('hidden');
            menuToggleButton.classList.add('hidden');
            exportButton.classList.add('hidden');

            let completed = 0;
            const total = files.length;
            
            const newlyAnalyzedPhotos = [];

            const analysisPromises = files.map((file, index) => {
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const imageSrc = e.target.result;
                        const analysisResult = await getPhotoMetadata(file, imageSrc);

                        newlyAnalyzedPhotos.push({
                            id: `photo-${Date.now()}-${index}`,
                            name: file.name,
                            src: imageSrc,
                            ...analysisResult
                        });

                        completed++;
                        const progress = Math.round((completed / total) * 100);
                        
                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `AI 분석 진행 중... (${completed}/${total})`;
                        
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
            });

            await Promise.all(analysisPromises);
            
            uploadedPhotos = uploadedPhotos.concat(newlyAnalyzedPhotos);
            
            progressText.textContent = "분석 완료! 앨범을 생성합니다.";
            progressDetails.textContent = "";
            
            setTimeout(displayResults, 1000);
        }
        
        // --- Gemini AI Analysis ---
        async function analyzeImageWithGemini(imageSrc, mimeType) {
            const apiKey = ""; // This will be handled by the execution environment.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const base64Data = imageSrc.split(',')[1];

            const prompt = `이 여행 사진을 분석해서 다음 JSON 형식으로 응답해줘: {"category": "카테고리명", "caption": "15자 이내의 짧은 한글 캡션", "tags": ["#한글태그1", "#한글태그2"], "location": "도시/지역 이름"}. 카테고리는 '음식', '풍경', '인물', '건축물', '야경', '기타' 중에서 가장 적절한 것 하나만 선택해줘. location은 사진이 찍힌 도시나 관광지 이름으로 부탁해 (예: "서울", "제주", "부산"). 만약 특정 지역을 알 수 없거나 "실내", "집안" 같은 일반적인 장소라면 "미상"으로 응답해줘.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: mimeType, data: base64Data } }
                    ]
                }],
                 generationConfig: {
                    responseMimeType: "application/json",
                 }
            };
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API call failed with status ${response.status}`);
            }

            const result = await response.json();
            const text = result.candidates[0].content.parts[0].text;
            return JSON.parse(text);
        }


        async function getPhotoMetadata(file, imageSrc) {
            const getDate = () => new Promise(resolve => {
                EXIF.getData(file, function() {
                    const exifDateStr = EXIF.getTag(this, "DateTimeOriginal");
                    if (exifDateStr) {
                        resolve(exifDateStr.split(" ")[0].replace(/:/g, "-"));
                    } else {
                        const d = new Date(file.lastModified);
                        resolve(`${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`);
                    }
                });
            });

            const date = await getDate();

            try {
                const analysis = await analyzeImageWithGemini(imageSrc, file.type);
                const locationBlocklist = ['실내', '집안', '미상'];
                if (!analysis.location || locationBlocklist.includes(analysis.location)) {
                    analysis.location = '장소 미확인';
                }
                return { ...analysis, date };
            } catch (error) {
                console.error("Gemini analysis failed for", file.name, error);
                // Fallback to a default if AI analysis fails
                return {
                    category: '기타',
                    caption: '여행의 특별한 기록',
                    tags: ['#여행'],
                    location: '장소 미확인',
                    date: date
                };
            }
        }


        // --- UI Display and Interaction ---
        function displayResults() {
            progressSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            exportButton.classList.remove('hidden');
            slideshowButton.classList.remove('hidden');
            
            if (uploadedPhotos.length > 0) {
                sidebar.classList.remove('hidden');
                sidebar.classList.add('md:flex');
            } else {
                sidebar.classList.add('hidden');
                menuToggleButton.classList.add('hidden');
                exportButton.classList.add('hidden');
                uploadSection.classList.remove('hidden');
                resultsSection.classList.add('hidden');
            }
            
            menuToggleButton.classList.remove('hidden');

            const allCategories = ['음식', '풍경', '인물', '건축물', '야경', '기타'].filter(c => uploadedPhotos.some(p => p.category === c));
            categoryNav.innerHTML = allCategories.map(c => `<a href="#" data-category="${c}" class="block px-4 py-2 text-slate-600 font-medium rounded-md hover:bg-sky-100 hover:text-sky-600 transition-colors">${c}</a>`).join('');

            const allDates = [...new Set(uploadedPhotos.map(p => p.date))].sort();
            
            const getLocationForDate = (date) => {
                const photosOnDate = uploadedPhotos.filter(p => p.date === date);
                if (!photosOnDate.length) return null;

                const locationCounts = photosOnDate.reduce((acc, photo) => {
                    const loc = photo.location || '장소 미확인';
                    acc[loc] = (acc[loc] || 0) + 1;
                    return acc;
                }, {});

                const topLocation = Object.keys(locationCounts).reduce((a, b) => locationCounts[a] > locationCounts[b] ? a : b);
                return topLocation !== '장소 미확인' ? topLocation : null;
            };

            dateNav.innerHTML = allDates.map(date => {
                const location = getLocationForDate(date);
                const title = location ? `${date} (${location})` : date;
                return `<a href="#" data-date="${date}" class="block px-4 py-2 text-slate-600 font-medium rounded-md hover:bg-sky-100 hover:text-sky-600 transition-colors">${title}</a>`;
            }).join('');
            
            const sortedPhotos = uploadedPhotos.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            gallery.innerHTML = `
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                    ${sortedPhotos.map(p => createPhotoCardHTML(p, allCategories)).join('')}
                </div>`;

            addCardEventListeners();
            applyFilters();
            savePhotosToDB();
        }
        
        function createPhotoCardHTML(photo, allCategories) {
            const displayTags = [...photo.tags, `#${photo.date}`];
            return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-1 transition-all duration-300 group" data-id="${photo.id}" data-category="${photo.category}" data-date="${photo.date}">
                    <div class="relative">
                        <img src="${photo.src}" alt="${photo.caption}" class="w-full h-48 object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300"></div>
                        <button data-delete-id="${photo.id}" class="absolute top-2 right-2 p-1.5 bg-black bg-opacity-40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none hover:bg-opacity-60 z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="p-4 space-y-3">
                        <input type="text" value="${photo.caption}" data-field="caption" class="w-full border-b-2 border-slate-200 focus:border-sky-400 outline-none text-md font-semibold p-1" placeholder="캡션 수정...">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-slate-500">분류:</span>
                            <select data-field="category" class="text-sm bg-slate-100 border-none rounded-md px-2 py-1 focus:ring-2 focus:ring-sky-300 outline-none">
                                ${allCategories.map(cat => `<option value="${cat}" ${cat === photo.category ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-2 text-xs">
                            ${displayTags.map(tag => `<span class="bg-slate-200 text-slate-600 px-2 py-1 rounded-full">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>`;
        }
        
        function addCardEventListeners() {
            gallery.querySelectorAll('.group').forEach(card => {
                card.querySelector('input[data-field="caption"]').addEventListener('change', (e) => updatePhotoData(card.dataset.id, 'caption', e.target.value));
                card.querySelector('select[data-field="category"]').addEventListener('change', (e) => {
                    const newCategory = e.target.value;
                    updatePhotoData(card.dataset.id, 'category', newCategory);
                    card.dataset.category = newCategory;
                });
                 card.querySelector('[data-delete-id]').addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const photoId = e.currentTarget.dataset.deleteId;
                    showConfirmation('이 사진을 앨범에서 삭제하시겠습니까?', () => {
                        uploadedPhotos = uploadedPhotos.filter(p => p.id !== photoId);
                        savePhotosToDB().then(() => {
                            displayResults();
                        });
                    });
                });
            });
        }
        
        function updatePhotoData(photoId, field, value) {
            const photo = uploadedPhotos.find(p => p.id === photoId);
            if (photo) {
                photo[field] = value;
                savePhotosToDB();
            }
        }
        
        function handleNavClick(e) {
            e.preventDefault();
            const link = e.target.closest('a');
            if (!link) return;
            
            if (window.innerWidth < 768) { // md breakpoint
                toggleSidebar();
            }

            const category = link.dataset.category;
            const date = link.dataset.date;

            if (category) {
                 toggleCategoryFilter(category, link);
            } else if (date) {
                 toggleDateFilter(date, link);
            }
        }
        
        categoryNav.addEventListener('click', handleNavClick);
        dateNav.addEventListener('click', handleNavClick);
        
        resetAlbumButton.addEventListener('click', () => {
             showConfirmation("정말로 현재 앨범을 지우고 새로 시작하시겠습니까?", async () => {
                try {
                    await db.clearPhotos();
                    window.location.reload();
                } catch(e) {
                    console.error("Failed to clear DB:", e);
                    showNotification("앨범을 초기화하는 데 실패했습니다.");
                }
            });
        });

        filterResetButton.addEventListener('click', (e) => {
            e.preventDefault();
            activeCategoryFilter = null;
            activeDateFilter = null;
            
            dateNav.querySelectorAll('a').forEach(a => a.classList.remove('bg-sky-100', 'text-sky-600'));
            categoryNav.querySelectorAll('a').forEach(a => a.classList.remove('bg-sky-100', 'text-sky-600'));

            applyFilters();
        });

        function toggleCategoryFilter(category, link) {
            if (activeCategoryFilter === category) {
                activeCategoryFilter = null; // Untoggle
            } else {
                activeCategoryFilter = category;
            }
            // Update UI
            categoryNav.querySelectorAll('a').forEach(a => a.classList.remove('bg-sky-100', 'text-sky-600'));
            if(activeCategoryFilter){
                link.classList.add('bg-sky-100', 'text-sky-600');
            }
            applyFilters();
        }

        function toggleDateFilter(date, link) {
            if (activeDateFilter === date) {
                activeDateFilter = null; // Untoggle
            } else {
                activeDateFilter = date;
            }
            // Update UI
            dateNav.querySelectorAll('a').forEach(a => a.classList.remove('bg-sky-100', 'text-sky-600'));
            if(activeDateFilter){
                link.classList.add('bg-sky-100', 'text-sky-600');
            }
            applyFilters();
        }

        function applyFilters() {
            gallery.querySelectorAll('.group').forEach(card => {
                const categoryMatch = !activeCategoryFilter || card.dataset.category === activeCategoryFilter;
                const dateMatch = !activeDateFilter || card.dataset.date === activeDateFilter;

                if (categoryMatch && dateMatch) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });

            if (activeCategoryFilter || activeDateFilter) {
                filterResetButton.classList.remove('hidden');
            } else {
                filterResetButton.classList.add('hidden');
            }
        }


        // --- Data Persistence ---
        async function savePhotosToDB() {
            try {
                await db.savePhotos(uploadedPhotos);
            } catch (e) {
                console.error("Failed to save photos to DB:", e);
                showNotification("앨범을 저장하는 데 실패했습니다. 브라우저 저장 공간이 부족할 수 있습니다.");
            }
        }

        // --- Slideshow Creation Logic ---
        async function createSlideshow() {
            if (uploadedPhotos.length === 0) {
                showNotification('업로드된 사진이 없습니다.');
                return;
            }
            
            try {
                slideshowCreate.disabled = true;
                slideshowCreate.innerHTML = '<svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="ml-2">생성 중...</span>';
                
                const duration = parseInt(photoDuration.value);
                const effect = transitionEffect.value;
                const order = document.querySelector('input[name="photo-order"]:checked').value;
                const musicFile = backgroundMusic.files[0];
                
                // Sort photos based on order
                let sortedPhotos = [...uploadedPhotos];
                switch(order) {
                    case 'date':
                        sortedPhotos.sort((a, b) => new Date(a.date) - new Date(b.date));
                        break;
                    case 'random':
                        sortedPhotos.sort(() => Math.random() - 0.5);
                        break;
                    case 'category':
                        sortedPhotos.sort((a, b) => a.category.localeCompare(b.category));
                        break;
                }
                
                // Create slideshow HTML
                const slideshowHTML = generateSlideshowHTML(sortedPhotos, duration, effect, musicFile);
                
                // Download the slideshow
                const blob = new Blob([slideshowHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'my-travel-slideshow.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                hideSlideshowModal();
                showNotification('슬라이드쇼가 성공적으로 생성되었습니다!');
                
            } catch (error) {
                console.error('Slideshow creation failed:', error);
                showNotification('슬라이드쇼 생성에 실패했습니다.');
            } finally {
                slideshowCreate.disabled = false;
                slideshowCreate.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="ml-2">슬라이드쇼 생성</span>';
            }
        }
        
        async function generateSlideshowHTML(photos, duration, effect, musicFile) {
            const totalDuration = photos.length * duration;
            let musicData = null;
            if (musicFile) {
                try {
                    const arrayBuffer = await musicFile.arrayBuffer();
                    const uint8Array = new Uint8Array(arrayBuffer);
                    musicData = `data:${musicFile.type};base64,${btoa(String.fromCharCode(...uint8Array))}`;
                } catch (error) {
                    console.error('Music file processing failed:', error);
                }
            }
            
            return `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>여행 슬라이드쇼</title>
                    <script src="https://cdn.tailwindcss.com"></script>
                    <style>
                        body { font-family: 'Noto Sans KR', sans-serif; }
                        .slide { opacity: 0; transition: opacity 1s ease-in-out; }
                        .slide.active { opacity: 1; }
                        .slide.fade { transition: opacity 1s ease-in-out; }
                        .slide.slide { transition: transform 1s ease-in-out, opacity 1s ease-in-out; }
                        .slide.zoom { transition: transform 1s ease-in-out, opacity 1s ease-in-out; }
                        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; }
                        .progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: #38bdf8; transition: width 0.1s linear; }
                    </style>
                </head>
                <body class="bg-black m-0 p-0 overflow-hidden">
                    <div class="progress-bar" id="progress-bar"></div>
                    
                    <div class="slideshow-container w-full h-screen relative">
                        ${photos.map((photo, index) => `
                            <div class="slide absolute inset-0 ${effect}" data-index="${index}">
                                <img src="${photo.src}" alt="${photo.caption}" class="w-full h-full object-cover">
                                <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-6">
                                    <h2 class="text-2xl font-bold mb-2">${photo.caption}</h2>
                                    <p class="text-lg">${photo.date} • ${photo.category}</p>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        ${photo.tags.map(tag => `<span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm">${tag}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="controls bg-black bg-opacity-50 rounded-full p-2 flex items-center space-x-4">
                        <button id="play-pause" class="text-white hover:text-sky-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <button id="prev" class="text-white hover:text-sky-400 transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                        </button>
                        <button id="next" class="text-white hover:text-sky-400 transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                            </svg>
                        </button>
                        <span id="timer" class="text-white text-sm">0:00 / ${Math.floor(totalDuration / 60)}:${String(totalDuration % 60).padStart(2, '0')}</span>
                    </div>
                    
                    <audio id="background-music" loop>
                        ${musicData ? `<source src="${musicData}" type="${musicFile.type}">` : ''}
                    </audio>
                    
                    <script>
                        let currentSlide = 0;
                        let isPlaying = true;
                        let slideInterval;
                        const slides = document.querySelectorAll('.slide');
                        const totalSlides = slides.length;
                        const slideDuration = ${duration} * 1000;
                        const progressBar = document.getElementById('progress-bar');
                        const playPauseBtn = document.getElementById('play-pause');
                        const prevBtn = document.getElementById('prev');
                        const nextBtn = document.getElementById('next');
                        const timer = document.getElementById('timer');
                        const music = document.getElementById('background-music');
                        
                        function showSlide(index) {
                            slides.forEach(slide => slide.classList.remove('active'));
                            slides[index].classList.add('active');
                            
                            const progress = ((index + 1) / totalSlides) * 100;
                            progressBar.style.width = progress + '%';
                            
                            const currentTime = Math.floor((index * ${duration}) / 60);
                            const currentSeconds = Math.floor((index * ${duration}) % 60);
                            timer.textContent = \`\${currentTime}:\${String(currentSeconds).padStart(2, '0')} / \${Math.floor(${totalDuration} / 60)}:\${String(${totalDuration} % 60).padStart(2, '0')}\`;
                        }
                        
                        function nextSlide() {
                            currentSlide = (currentSlide + 1) % totalSlides;
                            showSlide(currentSlide);
                        }
                        
                        function prevSlide() {
                            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                            showSlide(currentSlide);
                        }
                        
                        function startSlideshow() {
                            if (slideInterval) clearInterval(slideInterval);
                            slideInterval = setInterval(nextSlide, slideDuration);
                        }
                        
                        function stopSlideshow() {
                            if (slideInterval) clearInterval(slideInterval);
                        }
                        
                        function togglePlayPause() {
                            if (isPlaying) {
                                stopSlideshow();
                                playPauseBtn.innerHTML = '<path d="M8 5v14l11-7z"/>';
                                music.pause();
                            } else {
                                startSlideshow();
                                playPauseBtn.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                                music.play();
                            }
                            isPlaying = !isPlaying;
                        }
                        
                        // Event listeners
                        playPauseBtn.addEventListener('click', togglePlayPause);
                        prevBtn.addEventListener('click', () => { prevSlide(); stopSlideshow(); });
                        nextBtn.addEventListener('click', () => { nextSlide(); stopSlideshow(); });
                        
                        // Keyboard controls
                        document.addEventListener('keydown', (e) => {
                            switch(e.key) {
                                case 'ArrowLeft': prevSlide(); break;
                                case 'ArrowRight': nextSlide(); break;
                                case ' ': togglePlayPause(); break;
                                case 'Escape': window.close(); break;
                            }
                        });
                        
                        // Initialize
                        showSlide(0);
                        startSlideshow();
                        if (music.src) music.play();
                        
                        // Auto-advance slides
                        setInterval(() => {
                            if (isPlaying) nextSlide();
                        }, slideDuration);
                    </script>
                </body>
                </html>
            `;
        }
        
        // --- Export Logic ---
        exportButton.addEventListener('click', () => {
             const albumHTML = generateAlbumHTML();
             const blob = new Blob([albumHTML], { type: 'text/html' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = 'my-travel-album.html';
             a.click();
             URL.revokeObjectURL(url);
        });

        function generateAlbumHTML() {
            const bodyContent = `
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    ${uploadedPhotos.sort((a,b) => new Date(a.date) - new Date(b.date)).map(photo => {
                        const displayTags = [...photo.tags, `#${photo.date}`];
                        return `
                        <div class="bg-white rounded-lg shadow-md overflow-hidden">
                            <img src="${photo.src}" alt="${photo.caption}" class="w-full h-56 object-cover">
                            <div class="p-4">
                                <p class="font-semibold text-gray-700">${photo.caption}</p>
                                <div class="mt-2 flex flex-wrap gap-2 text-xs">
                                     <span class="bg-sky-100 text-sky-700 px-2 py-1 rounded-full">${photo.category}</span>
                                     ${displayTags.map(tag => `<span class="bg-gray-200 text-gray-600 px-2 py-1 rounded-full">${tag}</span>`).join('')}
                                </div>
                            </div>
                        </div>`;
                        }).join('')}
                </div>`;

            return `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>나의 여행 앨범</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
                    <style> body { font-family: 'Noto Sans KR', sans-serif; } </style>
                </head>
                <body class="bg-gray-100">
                    <div class="container mx-auto p-4 sm:p-8">
                        <header class="text-center mb-12">
                            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800">나의 특별한 여행 앨범</h1>
                            <p class="text-gray-500 mt-2">Gemini AI와 함께 만든 추억의 기록</p>
                        </header>
                        <main>${bodyContent}</main>
                        <footer class="text-center mt-12 py-6 border-t">
                             <p class="text-gray-500">Generated by Gemini AI Travel Album Maker</p>
                        </footer>
                    </div>
                </body>
                </html>`;
        }
    </script>
</body>
</html>

